# nginx.conf

worker_processes auto; # Automatically determine the number of worker processes

events {
    worker_connections 1024; # Max connections per worker process
}

http {
    include       mime.types; # Include MIME types
    default_type  application/octet-stream; # Default MIME type

    sendfile        on; # Enable sendfile for efficient file transfers
    tcp_nopush      on; # Don't send partial packets

    keepalive_timeout  65; # Timeout for keep-alive connections

    gzip on; # Enable gzip compression
    gzip_vary on; # Add Vary: Accept-Encoding header
    gzip_proxied any; # Compress for all requests, even if proxied
    gzip_comp_level 6; # Compression level (1-9, 6 is a good balance)
    gzip_buffers 16 8k; # Number and size of buffers for compression
    gzip_http_version 1.1; # Minimum HTTP version for compression
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    # Types of files to compress

    server {
        listen 80; # Listen on port 80 for incoming HTTP requests

        # Set the root directory for serving files.
        # This should point to where your React build output (index.html, JS, CSS) is located.
        # In the Dockerfile, we copy to /usr/share/nginx/html.
        root /usr/share/nginx/html;

        # Try files in order:
        # 1. Try to serve the exact file requested ($uri).
        # 2. If not found, try to serve the file with a trailing slash ($uri/).
        # 3. If still not found, serve /index.html. This is crucial for SPAs.
        #    The '=' sign ensures an internal redirect (not client-side).
        location / {
            try_files $uri $uri/ /index.html =404;
        }

        # Optional: Disable caching for index.html during development to ensure fresh content.
        # You might remove this or adjust caching headers for production.
        location = /index.html {
            add_header Cache-Control "no-cache, no-store, must-revalidate";
            add_header Pragma "no-cache";
            expires 0;
        }

        # Optional: For favicon.ico requests, you might want to serve it directly
        # or return a 204 No Content if you don't have one to avoid log errors.
        location = /favicon.ico {
            log_not_found off; # Don't log 404 for favicon
            access_log off; # Don't log access for favicon
        }

        # Optional: Error page for 404 Not Found
        # You can point this to a custom HTML error page if you have one.
        # error_page 404 /404.html;
        # location = /404.html {
        #    internal;
        # }
    }
}